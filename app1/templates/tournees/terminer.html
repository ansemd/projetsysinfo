<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Terminer Tourn√©e {{ tournee.get_numero_tournee }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background: #28a745;
            color: white;
        }
        .btn-secondary {
            background: #666;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }
        .alert-danger {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .form-group {
            margin: 20px 0;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 200px;
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group small {
            display: block;
            color: #666;
            margin-top: 5px;
        }
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .info-box li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úÖ Terminer la Tourn√©e {{ tournee.get_numero_tournee }}</h1>
            <a href="{% url 'detail_tournee' tournee.id %}" class="btn btn-secondary">‚Üê Retour</a>
        </div>
        
        <hr>
        
        <!-- Messages d'erreur/succ√®s -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %}">
                    <strong>{{ message }}</strong>
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="alert-success">
            <h2 style="color: #28a745; margin-top: 0;">üìã Informations de la tourn√©e</h2>
            
            <table>
                <tr>
                    <th>N¬∞ Tourn√©e</th>
                    <td>{{ tournee.get_numero_tournee }}</td>
                </tr>
                <tr>
                    <th>Chauffeur</th>
                    <td>{{ tournee.chauffeur.prenom }} {{ tournee.chauffeur.nom }}</td>
                </tr>
                <tr>
                    <th>V√©hicule</th>
                    <td>{{ tournee.vehicule.numero_immatriculation }} ({{ tournee.vehicule.marque }} {{ tournee.vehicule.modele }})</td>
                </tr>
                <tr>
                    <th>Zone cible</th>
                    <td>{{ tournee.get_zone_cible_display }}</td>
                </tr>
                <tr>
                    <th>Date de d√©part</th>
                    <td>{{ tournee.date_depart|date:"d/m/Y √† H:i" }}</td>
                </tr>
                <tr>
                    <th>Kilom√©trage de d√©part</th>
                    <td><strong>{{ tournee.kilometrage_depart }} km</strong></td>
                </tr>
                <tr>
                    <th>Nombre d'exp√©ditions</th>
                    <td>{{ tournee.expeditions.count }}</td>
                </tr>
            </table>
            
            <form method="POST">
                {% csrf_token %}
                
                <h3>üìù Informations de fin de tourn√©e</h3>
                
                <div class="form-group">
                    <label for="kilometrage_arrivee">
                        üöó Kilom√©trage d'arriv√©e (obligatoire) :
                    </label>
                    <input 
                        type="number" 
                        id="kilometrage_arrivee"
                        name="kilometrage_arrivee" 
                        required 
                        min="{{ tournee.kilometrage_depart|add:1 }}" 
                        step="1"
                        placeholder="Ex: {{ tournee.kilometrage_depart|add:100 }}"
                    > km
                    <small>‚ö†Ô∏è Doit √™tre sup√©rieur √† {{ tournee.kilometrage_depart }} km</small>
                </div>
                
                <div class="info-box">
                    <p style="margin-top: 0;">
                        <strong>‚ÑπÔ∏è Actions automatiques lors de la finalisation :</strong>
                    </p>
                    <ul>
                        <li>‚úÖ Le <strong>kilom√©trage parcouru</strong> sera calcul√© automatiquement</li>
                        <li>‚õΩ La <strong>consommation de carburant</strong> sera estim√©e ({{ tournee.vehicule.consommation_moyenne }} L/100km)</li>
                        <li>üìÖ La <strong>date de retour r√©elle</strong> sera enregistr√©e</li>
                        <li>üë®‚Äç‚úàÔ∏è Le <strong>chauffeur</strong> sera remis <span style="color: green;">DISPONIBLE</span></li>
                        <li>üöó Le <strong>v√©hicule</strong> sera remis <span style="color: green;">DISPONIBLE</span></li>
                        <li>üì¶ Toutes les exp√©ditions <span style="color: orange;">EN_TRANSIT</span> seront marqu√©es <span style="color: green;">LIVR√âES</span></li>
                        <li>üîß Le kilom√©trage du v√©hicule sera mis √† jour dans le syst√®me</li>
                    </ul>
                </div>
                
                <div style="margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Finaliser la tourn√©e
                    </button>
                    <a href="{% url 'detail_tournee' tournee.id %}" class="btn btn-secondary">
                        ‚ùå Annuler
                    </a>
                </div>
            </form>
        </div>
    </div>
</body>
</html>