<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste des Chauffeurs</title>
</head>
<body>
    <h1>Liste des Chauffeurs</h1>
    
    <!-- Statistiques -->
    <div>
        <p><strong>Total:</strong> {{ stats.total_chauffeurs }} | 
           <strong>Disponibles:</strong> {{ stats.disponibles }} | 
           <strong>En tourn√©e:</strong> {{ stats.en_tournee }} | 
           <strong>En cong√©:</strong> {{ stats.en_conge }}</p>
    </div>
    
    <hr>
    
    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <p style="color: green;"><strong>{{ message }}</strong></p>
        {% endfor %}
    {% endif %}
    
    <!-- Recherche et Filtrage -->
    <form method="get">
        <input type="text" name="search" placeholder="Rechercher..." value="{{ search }}">
        
        <label>Filtrer par statut:</label>
        <select name="statut">
            <option value="">-- Tous --</option>
            {% for code, label in statuts %}
            <option value="{{ code }}" {% if filtre_statut == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        
        <button type="submit">Filtrer</button>
        <a href="{% url 'liste_chauffeurs' %}"><button type="button">R√©initialiser</button></a>
    </form>
    
    <br>
    <a href="{% url 'creer_chauffeur' %}"><button>+ Nouveau Chauffeur</button></a>
    <a href="{% url 'exporter_chauffeurs_pdf' %}"><button style="background: #dc3545; color: white;">üìÑ Exporter PDF</button></a>
    
    <hr>
    
    <!-- Tableau des chauffeurs -->
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Pr√©nom</th>
                <th>T√©l√©phone</th>
                <th>Statut</th>
                <th>Changer Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for chauffeur in chauffeurs %}
            <tr>
                <td>CH-{{ chauffeur.id|stringformat:"03d" }}</td>
                <td>{{ chauffeur.nom }}</td>
                <td>{{ chauffeur.prenom }}</td>
                <td>{{ chauffeur.telephone }}</td>
                <td><strong>{{ chauffeur.get_statut_disponibilite_display }}</strong></td>
                <td>
                    <!-- Formulaire pour changer le statut -->
                    <form method="POST" action="{% url 'modifier_statut_chauffeur' chauffeur.id %}" style="display:inline;">
                        {% csrf_token %}
                        <select name="statut">
                            {% for code, label in statuts %}
                            <option value="{{ code }}" {% if chauffeur.statut_disponibilite == code %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit">‚úì</button>
                    </form>
                </td>
                <td>
                    <a href="{% url 'detail_chauffeur' chauffeur.id %}"><button>Voir</button></a>
                    <a href="{% url 'modifier_chauffeur' chauffeur.id %}"><button>Modifier</button></a>
                    <a href="{% url 'supprimer_chauffeur' chauffeur.id %}"><button>Supprimer</button></a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Aucun chauffeur trouv√©</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>