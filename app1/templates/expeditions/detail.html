<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>D√©tails Exp√©dition - {{ expedition.get_numero_expedition }}</title>
</head>
<body>
    <h1>D√©tails de l'Exp√©dition {{ expedition.get_numero_expedition }}</h1>
    
    <a href="{% url 'liste_expeditions' %}"><button>‚Üê Retour √† la liste</button></a>
    {% if expedition.statut == 'EN_ATTENTE' %}
        <a href="{% url 'modifier_expedition' expedition.id %}"><button>Modifier</button></a>
        <a href="{% url 'supprimer_expedition' expedition.id %}"><button>Supprimer</button></a>
    {% endif %}
    <a href="{% url 'exporter_expedition_detail_pdf' expedition.id %}"><button style="background: #dc3545; color: white;">üìÑ Exporter PDF</button></a>
    
    <hr>
    
    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <p style="color: green;"><strong>{{ message }}</strong></p>
        {% endfor %}
    {% endif %}
    
    <!-- Informations de l'exp√©dition -->
    <h2>Informations de l'Exp√©dition</h2>
    <table border="1" cellpadding="10">
        <tr>
            <th>N¬∞ Exp√©dition</th>
            <td><strong>{{ expedition.get_numero_expedition }}</strong></td>
        </tr>
        <tr>
            <th>Client</th>
            <td>{{ expedition.client.prenom }} {{ expedition.client.nom }} ({{ expedition.client }})</td>
        </tr>
        <tr>
            <th>T√©l√©phone client</th>
            <td>{{ expedition.client.telephone }}</td>
        </tr>
        <tr>
            <th>Destination</th>
            <td>{{ expedition.destination.ville }} - {{ expedition.destination.wilaya }}, {{ expedition.destination.pays }}</td>
        </tr>
        <tr>
            <th>Type de service</th>
            <td><strong>{{ expedition.type_service.get_type_service_display }}</strong></td>
        </tr>
        <tr>
            <th>Destinataire</th>
            <td>{{ expedition.nom_destinataire }}</td>
        </tr>
        <tr>
            <th>T√©l√©phone destinataire</th>
            <td>{{ expedition.telephone_destinataire }}</td>
        </tr>
        <tr>
            <th>Email destinataire</th>
            <td>{{ expedition.email_destinataire }}</td>
        </tr>
        <tr>
            <th>Adresse destinataire</th>
            <td>{{ expedition.adresse_destinataire }}</td>
        </tr>
        <tr>
            <th>Poids</th>
            <td>{{ expedition.poids }} kg</td>
        </tr>
        <tr>
            <th>Volume</th>
            <td>{{ expedition.volume|default:"Non sp√©cifi√©" }} m¬≥</td>
        </tr>
        <tr>
            <th>Montant total</th>
            <td><strong>{{ expedition.montant_total|floatformat:2 }} DA</strong></td>
        </tr>
        <tr>
            <th>Statut</th>
            <td>
                {% if expedition.statut == 'EN_ATTENTE' %}
                    <span style="color: blue;">‚è±Ô∏è {{ expedition.get_statut_display }}</span>
                {% elif expedition.statut == 'EN_TRANSIT' %}
                    <span style="color: orange;">üöö {{ expedition.get_statut_display }}</span>
                {% elif expedition.statut == 'LIVRE' %}
                    <span style="color: green;">‚úÖ {{ expedition.get_statut_display }}</span>
                {% else %}
                    <span style="color: red;">‚ùå {{ expedition.get_statut_display }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>Tourn√©e</th>
            <td>
                {% if expedition.tournee %}
                    <a href="{% url 'detail_tournee' expedition.tournee.id %}">
                        {{ expedition.tournee.get_numero_tournee }}
                    </a>
                {% else %}
                    Aucune tourn√©e affect√©e
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>Date livraison pr√©vue</th>
            <td>{{ expedition.date_livraison_prevue|date:"d/m/Y"|default:"Non calcul√©e" }}</td>
        </tr>
        {% if expedition.date_livraison_reelle %}
        <tr>
            <th>Date livraison r√©elle</th>
            <td>{{ expedition.date_livraison_reelle|date:"d/m/Y" }}</td>
        </tr>
        {% endif %}
        <tr>
            <th>Date de cr√©ation</th>
            <td>{{ expedition.date_creation|date:"d/m/Y H:i" }}</td>
        </tr>
        {% if expedition.description %}
        <tr>
            <th>Description</th>
            <td>{{ expedition.description }}</td>
        </tr>
        {% endif %}
        {% if expedition.remarques %}
        <tr>
            <th>Remarques</th>
            <td>{{ expedition.remarques }}</td>
        </tr>
        {% endif %}
    </table>
    
    <hr>
    
    <!--  TABLE TRACKING D√âTAILL√âE DESSOUS -->
    <h2>üìç Historique de Suivi (Tracking)</h2>
    
    {% if trackings %}
    <table border="1" cellpadding="10" style="margin-top: 20px;">
        <thead>
            <tr>
                <th>Date et Heure</th>
                <th>Statut</th>
                <th>Commentaire</th>
            </tr>
        </thead>
        <tbody>
            {% for tracking in trackings %}
            <tr>
                <td>{{ tracking.date_heure|date:"d/m/Y √† H:i" }}</td>
                <td>
                    <strong>{{ tracking.get_statut_etape_display }}</strong>
                </td>
                <td>{{ tracking.commentaire|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: orange;">‚ö†Ô∏è Aucun historique de suivi disponible</p>
    {% endif %}
    
</body>
</html>