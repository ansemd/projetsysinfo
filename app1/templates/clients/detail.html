<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>D√©tails Client - {{ client.prenom }} {{ client.nom }}</title>
</head>
<body>
    <h1>D√©tails du Client</h1>
    
    <a href="{% url 'liste_clients' %}"><button>‚Üê Retour √† la liste</button></a>
    <a href="{% url 'modifier_client' client.id %}"><button>Modifier</button></a>
    <a href="{% url 'supprimer_client' client.id %}"><button>Supprimer</button></a>
    
    <!-- AJOUTER CE BOUTON -->
    <a href="{% url 'exporter_client_detail_pdf' client.id %}"><button style="background: #dc3545; color: white;">üìÑ Exporter Fiche PDF</button></a>
    
    <hr>
    
    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <p style="color: green;"><strong>{{ message }}</strong></p>
        {% endfor %}
    {% endif %}
    
    <!-- Informations du client -->
    <h2>Informations Personnelles</h2>
    <table border="1" cellpadding="10">
        <tr>
            <th>ID Client</th>
            <td>CL-{{ client.id|stringformat:"03d" }}</td>
        </tr>
        <tr>
            <th>Nom</th>
            <td>{{ client.nom }}</td>
        </tr>
        <tr>
            <th>Pr√©nom</th>
            <td>{{ client.prenom }}</td>
        </tr>
        <tr>
            <th>Date de Naissance</th>
            <td>{{ client.date_naissance|date:"d/m/Y" }}</td>
        </tr>
        <tr>
            <th>T√©l√©phone</th>
            <td>{{ client.telephone }}</td>
        </tr>
        <tr>
            <th>Email</th>
            <td>{{ client.email|default:"Non renseign√©" }}</td>
        </tr>
        <tr>
            <th>Adresse</th>
            <td>{{ client.adresse|default:"Non renseign√©e" }}</td>
        </tr>
        <tr>
            <th>Ville</th>
            <td>{{ client.ville|default:"Non renseign√©e" }}</td>
        </tr>
        <tr>
            <th>Wilaya</th>
            <td>{{ client.wilaya|default:"Non renseign√©e" }}</td>
        </tr>
        <tr>
            <th>Solde</th>
            <td>{{ client.solde|floatformat:2 }} DA</td>
        </tr>
        <tr>
            <th>Date d'Inscription</th>
            <td>{{ client.date_inscription|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Derni√®re Modification</th>
            <td>{{ client.date_modification|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Remarques</th>
            <td>{{ client.remarques|default:"Aucune remarque" }}</td>
        </tr>
    </table>
    
    <hr>
    
    <!-- TOUTES les exp√©ditions du client -->
    <h2>Historique Complet des Exp√©ditions ({{ expeditions.count }})</h2>
    
    {% if expeditions %}
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>N¬∞ Exp√©dition</th>
                <th>Client</th>
                <th>Destination</th>
                <th>Tourn√©e</th>
                <th>Montant Total (DA)</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for exp in expeditions %}
            <tr>
                <td>EXP-{{ exp.id|stringformat:"06d" }}</td>
                <td>{{ exp.client.prenom }} {{ exp.client.nom }}</td>
                <td>{{ exp.destination.ville }} - {{ exp.destination.wilaya }}</td>
                <td>{% if exp.tournee %}Tourn√©e #{{ exp.tournee.id }}{% else %}‚Äî{% endif %}</td>
                <td>{{ exp.montant_total|floatformat:2 }}</td>
                <td>{{ exp.get_statut_display }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Aucune exp√©dition enregistr√©e pour ce client.</p>
    {% endif %}
    
    <hr>
    
    <!-- Factures r√©centes -->
    <h2>Factures R√©centes (5 derni√®res)</h2>
    
    {% if factures %}
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>N¬∞ Facture</th>
                <th>Date Cr√©ation</th>
                <th>Montant HT</th>
                <th>TVA</th>
                <th>Montant TTC</th>
                <th>Statut</th>
                <th>Date √âch√©ance</th>
            </tr>
        </thead>
        <tbody>
            {% for facture in factures %}
            <tr>
                <td>{{ facture.numero_facture }}</td>
                <td>{{ facture.date_creation|date:"d/m/Y H:i" }}</td>
                <td>{{ facture.montant_ht|floatformat:2 }} DA</td>
                <td>{{ facture.montant_tva|floatformat:2 }} DA</td>
                <td>{{ facture.montant_ttc|floatformat:2 }} DA</td>
                <td>{{ facture.get_statut_display }}</td>
                <td>{{ facture.date_echeance|date:"d/m/Y" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Aucune facture enregistr√©e.</p>
    {% endif %}
    
</body>
</html>