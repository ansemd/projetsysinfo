<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détails Client - {{ client.prenom }} {{ client.nom }}</title>
</head>
<body>
    <h1>Détails du Client</h1>
    
    <a href="{% url 'liste_clients' %}"><button>← Retour à la liste</button></a>
    <a href="{% url 'modifier_client' client.id %}"><button>Modifier</button></a>
    <a href="{% url 'supprimer_client' client.id %}"><button>Supprimer</button></a>
    
    <hr>
    
    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <p style="color: green;"><strong>{{ message }}</strong></p>
        {% endfor %}
    {% endif %}
    
    <!-- Informations du client -->
    <h2>Informations Personnelles</h2>
    <table border="1" cellpadding="10">
        <tr>
            <th>ID Client</th>
            <td>CL-{{ client.id|stringformat:"03d" }}</td>
        </tr>
        <tr>
            <th>Nom</th>
            <td>{{ client.nom }}</td>
        </tr>
        <tr>
            <th>Prénom</th>
            <td>{{ client.prenom }}</td>
        </tr>
        <tr>
            <th>Date de Naissance</th>
            <td>{{ client.date_naissance|date:"d/m/Y" }}</td>
        </tr>
        <tr>
            <th>Téléphone</th>
            <td>{{ client.telephone }}</td>
        </tr>
        <tr>
            <th>Email</th>
            <td>{{ client.email|default:"Non renseigné" }}</td>
        </tr>
        <tr>
            <th>Adresse</th>
            <td>{{ client.adresse|default:"Non renseignée" }}</td>
        </tr>
        <tr>
            <th>Ville</th>
            <td>{{ client.ville|default:"Non renseignée" }}</td>
        </tr>
        <tr>
            <th>Wilaya</th>
            <td>{{ client.wilaya|default:"Non renseignée" }}</td>
        </tr>
        <tr>
            <th>Solde</th>
            <td>{{ client.solde|floatformat:2 }} DA</td>
        </tr>
        <tr>
            <th>Date d'Inscription</th>
            <td>{{ client.date_inscription|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Dernière Modification</th>
            <td>{{ client.date_modification|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Remarques</th>
            <td>{{ client.remarques|default:"Aucune remarque" }}</td>
        </tr>
    </table>
    
    <hr>
    
    <!-- TOUTES les expéditions du client -->
    <h2>Historique Complet des Expéditions ({{ expeditions.count }})</h2>
    
    {% if expeditions %}
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>N° Expédition</th>
                <th>Client</th>
                <th>Destination</th>
                <th>Tournée</th>
                <th>Montant Total (DA)</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for exp in expeditions %}
            <tr>
                <td>EXP-{{ exp.id|stringformat:"06d" }}</td>
                <td>{{ exp.client.prenom }} {{ exp.client.nom }}</td>
                <td>{{ exp.destination.ville }} - {{ exp.destination.wilaya }}</td>
                <td>{% if exp.tournee %}Tournée #{{ exp.tournee.id }}{% else %}—{% endif %}</td>
                <td>{{ exp.montant_total|floatformat:2 }}</td>
                <td>{{ exp.get_statut_display }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Aucune expédition enregistrée pour ce client.</p>
    {% endif %}
    
    <hr>
    
    <!-- Factures récentes -->
    <h2>Factures Récentes (5 dernières)</h2>
    
    {% if factures %}
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>N° Facture</th>
                <th>Date Création</th>
                <th>Montant HT</th>
                <th>TVA</th>
                <th>Montant TTC</th>
                <th>Statut</th>
                <th>Date Échéance</th>
            </tr>
        </thead>
        <tbody>
            {% for facture in factures %}
            <tr>
                <td>{{ facture.numero_facture }}</td>
                <td>{{ facture.date_creation|date:"d/m/Y H:i" }}</td>
                <td>{{ facture.montant_ht|floatformat:2 }} DA</td>
                <td>{{ facture.montant_tva|floatformat:2 }} DA</td>
                <td>{{ facture.montant_ttc|floatformat:2 }} DA</td>
                <td>{{ facture.get_statut_display }}</td>
                <td>{{ facture.date_echeance|date:"d/m/Y" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Aucune facture enregistrée.</p>
    {% endif %}
    
</body>
</html>